import time
import random
import os
import math
import subprocess
from multitlp_testing import *


def ord(x,n):
    x=x%n
    s=x
    flag=1

    expn=100000000000000
    coeff=2.5

    count=0
    aa=[]
    nn=n.bit_length()
    start_time=time.time()
    #while(flag):
    for i in range(coeff*10**expn):
        s=pow(s,2,n)
        count=count+1
        #print(count)
        if(count%(coeff*10**(expn-2))==0):
            now=abs(start_time - time.time())
            print("made",  count, "in",now , "seconds with a", nn,"bit length of module"   )  
            aa.append(now)
    return aa


def mcm(a,b):
    g=math.gcd(a,b)
    return a*b/g


nbit=100
list={}

#carico un dizionario della forma
# nbit: (p,q,n,d)
mydict= {106: (9736059014546863, 2945556800007421, 28678114835572062522265352270323, 2), 212: (86657159549612078980859494626551, 23613432248682249608368894906523, 2046272965888012834862034247379941374785246382518466551938892173, 2), 317: (331607058113605261741609155433489672047261214241, 587263928675714936139026147180663120694127959431, 194740863724391938348330625495077160336526350397107079225670944981698250144346318753336647456871, 3), 424: (6419553020321671642859419835357896812766220411490899797618379323, 4475802823282694674388483250578519389658930538888546146352908527, 28732653532568687757988678256045972828557890373745888239666527868362104368768932440900374824489058223015044021699839513007187221, 2), 532: (59523445666445229185118053657852249541830858122546923047750136630425842720073939, 113180139053837008477610349246822842212576803044093860976849512370420776297943693, 6736871857491782924019508852731399718496442162682155364259584403884162418167624024759005510647752397990243667338300573033352752589376835815159004412658618716727, 3), 639: (1057583274111677699769881763778266744079925798462825196681406373137837849512057570927373993815397, 1071244783873388340629826994607391246781097686870135008156291495845556879616518583634496432552077, 1132930565903874596110183795872144843421015599630283743269692525618213581402724687757931516572476050681629623881474175442738417440305979112810094848617162040165576221156259812782315547126929569, 3), 745: (12957046637882544447811931025309752021244902831734766168045069590274512491388079862154058295265461261772125904603, 8295827830435400771854593979462248381589182690220734461714295706854840984500160432229709092229681670632243859421, 107489428098795452608460231714170148852497625714197694381266648950670272097669120761802018514662861342620443656493240834500354237120812710434404973622528836671089074515060526505814776816252347952617987560054978776131588814863, 3), 851: (67271007228635449634274148006010495740904061650548639336769226157543217735091067610748010311720639440839336622046384041267165819, 154574692809420416340997238313191150688690942215411342898250830744108055243368078603189895243363009176129234855964401854763524771, 10398395277346624886179779510424122261087320452798242818168716046678833953174018156598244260994176271325001807945264650281943250627453186480146140086167445062518201959216610530044472350025056683625936523490849708139716521130083920413367396655595757771002449, 3), 958: (1197345891982375160829337122594007699964375575691339444268868449674954377206104412215920760113346631181830825671127202750325832944433336170584591, 1454132893932440054862462869467535624467442237827634833452493403553326884187354349898079621421406314808673369950193324862193578532235063293681043, 1741100046946449966837494705106171110543947537792830130898496375659110191288579994750533144221075704024607409780313385016951132392295366906765487714304818378066768003684408635626138672228073859839975695684395134590693491256393230572424818889267037466790697959742250972809748261141604608413, 2), 1066: (15543745686645579776559989889493690485492194477753468291723647605404257409888243745685394388778377371052112533948727567811678325798108185118132201296473364621789, 18909415599129636569883079655986727565595041870756915695312544444471616985036014659436986618474546005108573815895214028137676510657155349475736063328765285000781, 293923147155959930085234055050631459828364435053367428270584830131139429206243156722630078702565495404097084368862747133495859500599700506568029993203813343694962259664512165212162798311843778572308945253991544318921692498205013468038214717804399990846221672841940162598656552273799945577551888384079340710923492634617209, 3), 1173: (403281242804230014574602506700011894952364809426491194558878627010212966860682431844647731080710628214984721075059568596700898559407783601842078410484707052682533502458327054151, 175395349319022117103789048973842276856564492749876466152735653633371966064997576526891497573471680593161049396322977355786789772566863692132783885676005261775766455558238422419, 70733654455457297950240145663094178032006334925359932765415326181226637622633804162958214013790495871332355243086369237831043511696304202135699337054345360736206304703974435437183401192126645073687546105299285321919066185529423547174669515601237671935711872535346846238973432995932502307204654375092798523205809027469908335398676888765457704201825411269, 2), 1279: (1960280886253589037765700646939909944192675756834361008612248688330154310419881362746627392861040829386049093312066127739373807613728575309314221333673806309107463173680729614617085282961808393, 2303863148889694560805608134305482495186551375350485461948421111431780604081648841935387238494992920116990274333279003908453498994038002102944088580805879260651495420375867323297946554014127149, 4516218895312474808996193153749847522951693116670865385536075519841260202325937254940855288883745630444154291867665675148556628245228406681269358083391197115977871031426230293134563558883731254933207730960909739053280394150488574427749067122094485187799123435921685145119648294110120433641998799524561954155240509087153549883446268225276755950574972474121627192835805040736350477361557, 2), 1386: (23969402722201198648863204162780287086288730677920687031262630010102378873087033909713961220019077055869630038567294042586510315514179106217067623627338255810410407462586645114241362707742820094688738428776651, 23627454445070563255430811328955179471401978221920583775374082379319247642143278389692754969767151424854813680386288621945010779722155390232727504211631157764370225944833696218516654407907213451652987058561463, 566335970894359170287221574975404382305885936559546410904550714311036655097623574161038927641724822926370339666371829548102178889925300026690505177121590123380507149341619338978554825830489320877161764862229876917517682451522585626942943929663032801682768082527541688375823413589127118633744071953723866335170270086803450897159425804308430861389905806289360370027813498863889408695543662889227993095232020018982800413, 2), 1491: (566200980332564053850638905787002306093904249678142318622832252141620751148665281100850460509401221412000117453662772832141852035657862066551411443283324537900291547788940452686867869834063774489242027002679320587378293982153, 85547102748088186825243542795623540083900423077964173800945096983248952678711092539123921221859340631923127977524731891806359442810636157479836481087327717343806382784000319170288796109737684490499959578026474156329767607357, 48436853440578115791957321956460176637623387142181318457816393115331063230882115438502679337139302745113858039349882935659810930198149222949461980560540200496100200994041215845572521180444461681371330805249870782958722490958908902899347163836575840466398906975408082710702346929795754195408429695183255535358575364547937640430195291606266190252019837562333727938967293032534518880177422085278640036640258340254871625013763775773471597799146469499621, 2), 1597: (1316090589283665395177917022713126017615192819285411553280708085574456108289191221709925264501591698686382647064317491984605299515667680648796146567505804906774233732455727926156255617857807495588177723033002996055939503960144347647022142363, 1977395529636685940971138842346221352252796856767633378090198321643739505048413701011532802707403813619858107378980480570450084615050992820133106303176941068904968939584584863180455587188707562456021319664095001454990828808713950010953661991, 2602431647846431640398162400319945488591491142427861958886157801326519251696587107636122548117475342900274895182460262351137806961445936774250920281208855761635436795647073498508561671154506375952116982763032421999568291010561744600783684864571319658847700611553884158977914322646837904937507566818034869929216420259929044217196218402138743249667361236148684132928493286258441378101535501471995638863180622310063061418377914097402340082697177153129061195356171538740575136984024733, 2), 1703: (21867665324129464495885100656473125178161972702077776339423133893850375215821812927375064562238773808732857917327132878423733114265400727466270750380662719706348549449472422767554632345670400617259903647909665860542996209219336188422407000311887057277481443, 13546238472238262857443669122126858046684695695994525703799406690189118924573616264532916837266408742493347109629978404690818996458318749644087662857352375616888279772743507647244295635046426273184691072247775707075065657586467446470279084991753424864229483, 296224609311753154288665761330298807184426663279960866994160371514493113629809691186443874421799335492471003002936922023908021853273161562680662813817025049587991969104262950157040140512195807414590997546904182640869791974167635995529696351078619429794913632511080562953371428081246107977049613466753184419745125089551115717016210775540581537926292445022059438584803970293536079737663765284012982444173117694179661025252586903096269429534977641172913567478490079931296967563314400884529292387541457020007025983969, 3), 1809: (228615308643420428217723889843895180450929472229008729699779803219810275915507666837792747297698510114019933537079018647112918507790274452493828997381552509211844288708229785134873981798918998024433454438135532145363781441413706686970383829250332700659180765850710689676049, 118444245167164024304045679375467379379604951277928983365559943756853093709477374819093788193481954926015110020798537998638703656305090639871121844962946677602666075794102776902889793355403058325978468603144618106418936304165281853563155708135198052128920103236298557963619, 27078167665928161848170638487822129857220587883845964055156907527327744348137411005959066930773986757099245784440879498735481471436797864023714028461461705565197929144582247066700094092954413230278821598496842908535468964944429001750505003580822765395457250979282188364190378735845252643831444739386028572592276458383517725895511767103997220416129553480895301909491090614053595863643720291741381161117235768944263454698455605220053680557701482082650427524288747456949364695115403922103402075595233778316929620616551041962197516268160236237661331, 2), 1914: (1005068680669532963927485896736906529741042552956059081144845714567221377772727006325271110742002266386857908904195182447376315171927761933238557737363887866874828127187608720668561225569292334815451033438926217257106959088400489860478421291275236746080407845303167682718451198529714970063, 904442174336611831329901937624769774804280142563783617092475550152548121817259894671927441599582643430095362297532209329248872242428792151352665179673206386118603939879314144359954291118263281441273785470048939280976847059352341373394149670812708346228014127192411017008850113520540971433, 909026502902382178671738824900405141690839001081575334580073443511505478911368701485736399791938756231752800740318005713614396232991986989589482980329208743209418915028640256709982370769372012014740615154104119878704648559046573126335438231818151919384494193255990283601647908570628323673992004985252316286022307429196472002836965155995830996606221230872321065973667017749475051868924294843494268729614595829262884832682642444344624763695614265223588493752276765164904281305833172639554645970577772203407239857758893580621318058360416202669174357273908529710138952196533210279, 3), 2021: (5981778689379259633223002760794848575991952827148154163924723403950673072607514115887792419846102668314109277789244236711618729721796970377590064344892081983598644205406961372903447294972252094390015397880524598270514470933379415237741375133309404449748080189927565555296473160575088925151448270761662183, 19305431312002784482558485694991014391307233328581358554105776812870658406041678958623515402412979374495085944710161220040671431748944623171856880034696290322020411394272228974650177503096236771842760681926454261163272344332672040027129344682095021055703688035829966755635711350830346660582786317067899069, 115480817611413336925030290945153766772683542215456305131925219738103649891744494829357355917188593507925977400992374271121533662496693241061415689112244907305385485727825131940118904573617370713819068728688405428166326713425155707143901896263249839652426595845258386059484880212284443371583045726621300855913909691273961568609396472815083316916183971757682910911955405239160863770148554173990867804960464749587954011467945435319278779261117865336261908887980742845570666954141294949524412849765300506408150454215493488324133744358923574587539786993397196545459763276287248611636147245560690015126794118207627, 2), 2128: (110985415027507441412069408367323058671734813582324765757607374062474005907600607827316251500697811297678910265768863028451624691314679510928953729595865516414131291477388866485285612218796450659338181097718207435289972655700346325494355397965037016025526681493789569514038394810522790295790875290482048925678478313997449, 193725651835526532753813785359324433087676563482219482798187231234714433187351195997954629418622513742302081625724390067637068315874567143716666710066752895737453396078258141246576127286580541240484578647449692832866771803679463727259953735359477333312119530647883309075199356299054955882641831534723160747452341450238229, 21500721870440320999073818341925077247191635375241379601913518621833437343644178143374848911098618957559537479036827926760975371163858026607231579226236975144807146505341104636433218722831983208550357823181030658480136267486833425355273965257358594721324306311729888921034925620088566570587798282214086220656022468156685012966682710882288311206528714217997019732073180890876905060862323950732005634208787632395451256889055298191876772771964776148418250100664753223520976600439490297797030974442302956841512696479508952842379902450841019511094546632294982607633932493951802390971057874803255922284971208829715862719054922797022587226348277821, 2)}

towrite="did 25*10^6 squaring and recorded data once every 10^6; therefore 25 mesurements. Various bit lengths from 100 to 2000 (inrc. by 100)"  

iters=1000
count=0
for i in range(iters):
    mex=os.urandom(2)
    #mex=b'\xea\xf2\x89\x99\x1eF\xdc\xfc?\x11\x1f\xef\x0cAN/\x8df\xc6\x84\xce{\xff\xddf&i\xec\x03Kv\x8b'
    # a tutti'
    t=10**3
    rsw=[]
    bm=[]
    for k in [1173]:
    #for k in mydict.keys():
        nbit=k
        p=mydict[k][0]
        q=mydict[k][1]
        n=mydict[k][2]
        d=mydict[k][3]
        a=random.randrange(12,n)
        rswPuzzle=rswGenPuzzle(mex,a,t,p,q)
        #print("rsw gen time with",k,"bits is", rswPuzzle[4])
        rsw.append((k,rswPuzzle[4]))
        bmPuzzle=bmGenPuzzle(mex,a,t,p,q,0)
        print("bm gen time with",k,"bits is", bmPuzzle[6]  )
        bm.append((k,bmPuzzle[6]))
        #print("rswSolPuzzle(rswPuzzle)==mex\t",rswSolPuzzle(rswPuzzle)[0]==mex)
        print("bmSolPuzzle(bmPuzzle)=\t", bmSolPuzzle(bmPuzzle))
        print("mex=\t", mex)
        if    bmSolPuzzle(bmPuzzle) == mex:
            count+=1

print("count is",count,"which means a rate of",round(100*count/iters,2),"%")



f=open("generation-values-from-test.txt",'a' )
#f.write(towrite)
f.write("rsw_times="+str(rsw))
f.write("\nbm_times="+str(bm))
f.close()

# to import, do 
# import ast
# f=open('values.txt','r')
# x=f.read()
# and evaluate the file with
# ast.literal_eval(x)
